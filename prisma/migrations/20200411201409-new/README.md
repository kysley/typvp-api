# Migration `20200411201409-new`

This migration has been generated by Evan Kysley at 4/11/2020, 8:14:09 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
ALTER TABLE "default$default"."Test" DROP CONSTRAINT IF EXiSTS "Test_account_fkey",
DROP CONSTRAINT IF EXiSTS "Test_trial_fkey",
DROP COLUMN "account",
DROP COLUMN "trial",
ADD COLUMN "accountId" text  NOT NULL ,
ADD COLUMN "trialId" text   ;

ALTER TABLE "default$default"."Trial" DROP CONSTRAINT IF EXiSTS "Trial_owner_fkey",
DROP COLUMN "owner",
ADD COLUMN "ownerId" text   ;

ALTER TABLE "default$default"."Test" ADD FOREIGN KEY ("trialId")REFERENCES "default$default"."Trial"("id") ON DELETE SET NULL  ON UPDATE CASCADE

ALTER TABLE "default$default"."Test" ADD FOREIGN KEY ("accountId")REFERENCES "default$default"."Account"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "default$default"."Trial" ADD FOREIGN KEY ("ownerId")REFERENCES "default$default"."Account"("id") ON DELETE SET NULL  ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200411185808-new..20200411201409-new
--- datamodel.dml
+++ datamodel.dml
@@ -3,9 +3,9 @@
 }
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url      = env("DATABASE_URL")
 }
 generator typegraphql {
   provider = "node_modules/typegraphql-prisma/generator.js"
@@ -29,9 +29,8 @@
   Trial             Trial[]
 }
 model Test {
-  account     String
   correct     Int
   corrections Int
   cpm         Int
   createdAt   DateTime   @default(now())
@@ -41,11 +40,12 @@
   type        ResultType
   updatedAt   DateTime   @default(now())
   wordIndex   Int
   wpm         Int
-  trial       String?
-  Account     Account    @relation(fields: [account], references: [id])
-  Trial       Trial?     @relation(fields: [trial], references: [id])
+  trialId     String?
+  trial       Trial?     @relation(fields: [trialId], references: [id])
+  account     Account    @relation(fields: [accountId], references: [id])
+  accountId   String
 }
 model Trial {
   createdAt     DateTime    @default(now())
@@ -54,14 +54,14 @@
   id            String      @id @default(cuid())
   maxWordLength Int?
   minWordLength Int?
   name          String
-  owner         String?
   private       Boolean?    @default(false)
   updatedAt     DateTime    @default(now())
   wordSet       String
   results       Trial[]
-  Account       Account?    @relation(fields: [owner], references: [id])
+  ownerId       String?
+  owner         Account?    @relation(name: "TrialOwner", fields: [ownerId], references: [id])
 }
 enum ResultType {
   SINGLEPLAYER
```


